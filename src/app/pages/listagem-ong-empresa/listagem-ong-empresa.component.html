<app-header *ngIf="userLogin" [userId]="userLogin.id"></app-header>
<main>
    <div *ngIf="userLogin?.tipoPerfil === 1" class="cabecalho-tabela">
        <h3 class="text">Doares Cadastrados</h3>
    </div>
    <div *ngIf="userLogin?.tipoPerfil === 2" class="cabecalho-tabela">
        <h3 class="text">ONG's Cadastradas</h3>
    </div>
    <div class="content">
        <div class="card">
            <p-table [value]="dataSource" [paginator]="true" [rows]="5" [tableStyle]="{ 'min-width': '50rem' }"
                [rowsPerPageOptions]="[5, 10, 20]">
                <ng-template #header>
                    <tr>
                        <th pSortableColumn="nome"
                            style="width:11% ; background-color: var(--p-emerald-700) !important; color: #fff;">Nome
                            <p-sortIcon field="nome" />
                        </th>
                        <th pSortableColumn="email"
                            style="width:12%; background-color: var(--p-emerald-700) !important; color: #fff;">Email
                            <p-sortIcon field="email" />
                        </th>
                        <th pSortableColumn="tipoPerfil"
                            style="width:6%; background-color: var(--p-emerald-700) !important; color: #fff;">Perfil
                            <p-sortIcon field="tipoPerfil" />
                        </th>
                        <th pSortableColumn="telefone"
                            style="width:10%; background-color: var(--p-emerald-700) !important; color: #fff;">Telefone
                            <p-sortIcon field="telefone" />
                        </th>
                        <th pSortableColumn="estado"
                            style="width:8%; background-color: var(--p-emerald-700) !important; color: #fff;">Estado
                            <p-sortIcon field="estado" />
                        </th>
                        <th pSortableColumn="cidade"
                            style="width:9%; background-color: var(--p-emerald-700) !important; color: #fff;">Cidade
                            <p-sortIcon field="cidade" />
                        </th>
                        <th pSortableColumn="bairro"
                            style="width:9%; background-color: var(--p-emerald-700) !important; color: #fff;">Bairro
                            <p-sortIcon field="bairro" />
                        </th>
                        <th pSortableColumn="tipoDoacao"
                            style="width:12%; background-color: var(--p-emerald-700) !important; color: #fff;">Tipo de
                            Doação <p-sortIcon field="tipoDoacao" />
                        </th>
                        <th *ngIf="userLogin?.tipoPerfil === 1"
                            style="width:10%; background-color: var(--p-emerald-700) !important; color: #fff;">Solicitar
                            Doação</th>
                        <th *ngIf="userLogin?.tipoPerfil === 2"
                            style="width:10%; background-color: var(--p-emerald-700) !important; color: #fff;">Realizar
                            Doação</th>
                    </tr>
                </ng-template>
                <ng-template #body let-item>
                    <tr>
                        <td>{{ item.nome }}</td>
                        <td>{{ item.email }}</td>
                        <td>{{ converterPerfil(item.tipoPerfil )}}</td>
                        <td>{{ item.telefone }}</td>
                        <td>{{ item.estado }}</td>
                        <td>{{ item.cidade }}</td>
                        <td>{{ item.bairro }}</td>
                        <td>{{ item.tipoDoacao }}</td>


                        <td class="buttons-table" *ngIf="this.userLogin.tipoPerfil === 1">
                            <p-button icon="pi pi-plus" class="mr-2" [rounded]="true" [outlined]="true"
                                (click)="openModalPagamento(item)" />
                        </td>

                        <td class="buttons-table" *ngIf="this.userLogin.tipoPerfil === 2">
                            <p-button icon="pi pi-plus" class="mr-2" [rounded]="true" [outlined]="true"
                                (click)="openModalPagamento(item)" />
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <div class="card flex justify-center">
        <p-dialog header="Realizar Doação" [modal]="true" [(visible)]="visible" [style]="{ width: '40rem' }">
            <ng-container>
                <form [formGroup]="formPagamentoPix">
                    <span class="p-text-secondary block mb-8" *ngIf="isPix && !isOng" >Pagar com Pix</span>
                    <span class="p-text-secondary block mb-8" *ngIf="isOng" >Solicitação de Doação</span>
                    <div class="flex items-center gap-4 mb-8">
                        <label for="email" class="font-semibold w-24">Email:</label>
                        <input pInputText id="email" class="flex-auto" autocomplete="off"
                            formControlName="emailPagador" />
                    </div>
                    <div class="flex items-center gap-4 mb-4">
                        <label for="username" class="font-semibold w-24">Valor:</label>
                        <p-inputnumber formControlName="valor" inputId="currency-us" mode="currency" currency="BRL"
                            locale="pt-BR" class="w-28" />

                    </div>
                    <div class="flex flex-col justify-start gap-4 mb-4">
                        <label for="username" class="font-semibold w-24 whitespace-nowrap">Descreva a doação:</label>
                        <textarea pTextarea rows="5" cols="30" class="h-full"
                            style="border:2px solid var(--p-emerald-700)" formControlName="descricao"></textarea>
                    </div>
                    <div class="flex justify-end gap-2" *ngIf="isPix && !isOng">
                        <p-button label="Cancelar" severity="secondary" (click)="visible = false" />
                        <p-button label="Gerar QRcode" (click)="gerarQRCode()" />
                    </div>
                    <div class="flex justify-end gap-2" *ngIf="isOng">
                        <p-button label="Cancelar" severity="secondary" (click)="visible = false" />
                        <p-button label="Confirmar Solicitação" (click)="gerarQRCode()" />
                    </div>
                </form>
            </ng-container>
            <ng-container *ngIf="isCartaoCredito && !isOng">
                <div class="flex items-center gap-4 mb-8">
                    <label for="email" class="font-semibold w-24">Email:</label>
                    <input pInputText id="email" class="flex-auto" autocomplete="off" />
                </div>
                <div class="flex items-center gap-4 mb-4">
                    <label for="username" class="font-semibold w-24">Valor:</label>
                    <input pInputText id="username" class="flex-auto" autocomplete="off" class="w-24" />
                </div>
                <div class="flex flex-col justify-start gap-4 mb-4">
                    <label for="username" class="font-semibold w-24 whitespace-nowrap">Descreva a doação:</label>
                    <textarea pTextarea rows="5" cols="30" class="h-full"
                        style="border:2px solid var(--p-emerald-700)"></textarea>
                </div>
            </ng-container>
        </p-dialog>
    </div>

    <div class="card flex justify-center">
        <p-dialog header="Realizar Doação" [modal]="true" [(visible)]="moodalQRCode" [style]="{ width: '40rem' }">
            <div *ngIf="qrCodeImageUrl" class="area-do-qrcode">

                <h3>Pagamento via Pix</h3>

                <img [src]="qrCodeImageUrl" alt="QR Code Pix" />

                <p>Ou copie o código abaixo:</p>

                <input pInputText [value]="qrCodeCopiaECola" readonly class="w-150"/>

                <div class="flex justify-end gap-2 pt-2">
                    <p-button label="Fechar" severity="secondary" (click)="moodalQRCode = false" />
                </div>
            </div>
        </p-dialog>
    </div>
</main>